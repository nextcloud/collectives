image: registry.gitlab.com/collectivecloud/docker-builds/dependencies

# Select what we should cache between builds
cache:
  paths:
    - vendor/

# Set any variables we need
variables:
  # Configure mysql environment variables (https://hub.docker.com/r/_/mysql/)
  MYSQL_DATABASE: mysql_database
  MYSQL_ROOT_PASSWORD: mysql_strong_password
  NEXTCLOUD_SOURCE: '/srv/nextcloud/server'

unit:
  script:
    - vendor/bin/phpunit --configuration phpunit.xml --coverage-text --colors=never
  before_script:
    - curl -sS https://getcomposer.org/installer | php
    - php composer.phar install
    - ln -s `pwd` $NEXTCLOUD_SOURCE/apps/wiki
  services:
    - mysql:5.7

integration:
  script:
    - vendor/bin/phpunit --configuration phpunit.integration.xml --coverage-text --colors=never
  before_script:
    - curl -sS https://getcomposer.org/installer | php
    - php composer.phar install
    - ln -s `pwd` $NEXTCLOUD_SOURCE/apps/wiki
  services:
    - mysql:5.7

lint:
  image: node
  script:
    - npm run lint
  before_script:
    - npm install
